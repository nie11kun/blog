<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"
xmlns:thr="http://purl.org/syndication/thread/1.0"
xml:lang="zh-CN"
xml:base="https://blog.niekun.net/2020/10/"
>
<title type="text">Marco Nie - 2020年10月</title>
<subtitle type="text">you are the company you keep...</subtitle>
<updated>2020-10-13T12:03:00+08:00</updated>
<generator uri="http://typecho.org/" version="1.2/18.10.23">Typecho</generator>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/2020/10/" />
<id>https://blog.niekun.net/feed/atom/2020/10/</id>
<link rel="self" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/2020/10/" />
<entry>
<title type="html"><![CDATA[wsl 2 激活 systemd]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1805.html" />
<id>https://blog.niekun.net/archives/1805.html</id>
<updated>2020-10-13T12:03:00+08:00</updated>
<published>2020-10-13T12:03:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[wsl 默认不支持 systemd，执行 systemd 命令会返回错误提示：# hostnamectlSystem has not been booted with systemd as in...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1805.html" xml:lang="zh-CN"><![CDATA[
<p>wsl 默认不支持 systemd，执行 systemd 命令会返回错误提示：</p><pre><code># hostnamectl
System has not been booted with systemd as init system (PID 1). Can't operate.
Failed to create bus connection: Host is down</code></pre><p>可以安装第三方的工具 genie 来激活 systemd。</p><p>GitHub：<a href="https://github.com/arkane-systems/genie">https://github.com/arkane-systems/genie</a></p><!--more--><h3>安装</h3><p>添加第三方 apt 库，在 <code>/etc/apt/sources.list.d</code> 目录下新建文件 <code>wsl-translinux.list</code>，文件内容如下：</p><pre><code>deb [trusted=yes] https://wsl-translinux.arkane-systems.net/apt/ /</code></pre><p>更新库列表：</p><pre><code>apt update &amp;&amp; apt upgrade
</code></pre><p>安装依赖包：</p><p>安装 Microsoft 依赖，下载对应系统版本的 prod 包：<a href="https://packages.microsoft.com/config/">https://packages.microsoft.com/config/</a>：</p><pre><code>curl -O https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb
dpkg -i packages-microsoft-prod.deb</code></pre><p>安装其他依赖：</p><pre><code>apt update &amp;&amp; apt install apt-transport-https daemonize dotnet-runtime-3.1</code></pre><p>安装 genie：</p><pre><code>apt install systemd-genie
</code></pre><h3>使用</h3><p>退出 wsl 系统后关闭 所有已打开的 wsl：</p><pre><code>wsl --shutdown
</code></pre><p>启动 wsl：</p><pre><code>wsl genie -s
</code></pre><p>启动的 Linux 系统就可以正常使用 systemd 了。</p><p>参考链接：<br><a href="https://gist.github.com/djfdyuruiry/6720faa3f9fc59bfdf6284ee1f41f950">https://gist.github.com/djfdyuruiry/6720faa3f9fc59bfdf6284ee1f41f950</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1805.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1805.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[wls 2 设置静态 DNS 服务地址及 Linux 和 Windows 主机网络互相访问设置]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1801.html" />
<id>https://blog.niekun.net/archives/1801.html</id>
<updated>2020-10-13T10:01:00+08:00</updated>
<published>2020-10-13T10:01:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[在升级到 wsl 2 后发现一些网络问题和之前的 wsl 不一样了，主要是 DNS 解析和 wsl 和 Windows 网络互访问题，这里介绍如何处理。DNS 解析wsl 2 使用的 DNS 解...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1801.html" xml:lang="zh-CN"><![CDATA[
<p>在升级到 wsl 2 后发现一些网络问题和之前的 wsl 不一样了，主要是 DNS 解析和 wsl 和 Windows 网络互访问题，这里介绍如何处理。</p><h3>DNS 解析</h3><p>wsl 2 使用的 DNS 解析服务器设置在文件：<code>/etc/resolv.conf</code> 内设置，这是一个 link 文件，真正的文件路径是：<code>/run/resolvconf/resolv.conf</code>，这个文件是每次 wsl 启动时自动生成的，内容如下：</p><pre><code># This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
# [network]
# generateResolvConf = false
nameserver 172.24.144.1</code></pre><!--more--><p>nameserver 后面的就是指定的 DNS 服务器地址。我发现有时候分配的服务器地址是无效的，如：<code>127.0.0.53</code>，使用 ping 来测试发现提示无法解析地址。需要设置一个固定的 DNS 地址，方法如下：</p><ul><li>新建文件：<code>/etc/wsl.conf</code>，内容如下：</li></ul><pre><code>[network]
generateResolvConf = false</code></pre><p>以上配置好就不会自动创建 <code>/run/resolvconf/resolv.conf</code> 文件了。</p><p>退出 wsl，关机然后重新启动：</p><pre><code>exit
wsl --shutdown
wsl
</code></pre><p>删除 link 文件：<code>/etc/resolv.conf</code>:</p><pre><code>rm /etc/resolv.conf
</code></pre><p>然后新建 <code>/etc/resolv.conf</code> 文件，内容如下，可自定义 nameserver 地址：</p><pre><code>nameserver 114.114.114.114
</code></pre><p>再次退出 wsl，关机然后重新启动：</p><pre><code>exit
wsl --shutdown
wsl
</code></pre><p>查看 <code>/etc/resolv.conf</code> 文件是否是之前自定义的地址：</p><pre><code>cat /etc/resolv.conf
</code></pre><p>测试网络服务：</p><pre><code>ping niekun.net
</code></pre><p>参考链接：<a href="https://github.com/microsoft/WSL/issues/5256#issuecomment-666545999">https://github.com/microsoft/WSL/issues/5256#issuecomment-666545999</a></p><h3>网络访问配置</h3><p>以前使用 wsl 时 Linux 子系统和 Windows 主机的网络好像是直接互通的，比如我在 Windows 下建立了一个 http 网页 <code>http://127.0.0.1:6000</code>，可以在 Linux 子系统下直接访问地址 <code>http://127.0.0.1:6000</code>，同理对于 Windows 主机访问 Linux 子系统的服务也是可以使用 localhost 直接访问的。</p><p>在升级到 wsl 2 后发现这一特性没有了，无法直接通过 localhost 地址来互通，查询官方说明关于<a href="https://docs.microsoft.com/en-us/windows/wsl/compare-versions#accessing-network-applications">wsl 2 访问网络服务</a> 的方法可以实现访问，但是每次关机后 wsl 和 Windows 本地地址会发生变化不方便使用。</p><p><strong>可以设置静态 IP 来固定地址。Windows 终端下执行下面命令：</strong></p><p>在 wsl 下增加 IP 地址：<code>192.168.50.16</code>，名称为：<code>eth0:1</code>:(以 Ubuntu 系统为例)</p><pre><code>wsl -d Ubuntu -u root ip addr add 192.168.50.16/24 broadcast 192.168.50.255 dev eth0 label eth0:1
</code></pre><p>在 Windows 10 下增加一个 IP 地址：(此命令需要管理员权限执行)</p><pre><code>netsh interface ip add address &quot;vEthernet (WSL)&quot; 192.168.50.88 255.255.255.0
</code></pre><p>执行后，在 wsl 下通过 IP：<code>192.168.50.88</code> 访问 Windows 服务。在 Windows 下通过 IP：<code>192.168.50.16</code> 访问 wsl 服务。</p><p>完成后再终端使用 ipconfig 查看设置：</p><pre><code>Ethernet adapter vEthernet (WSL):

   Connection-specific DNS Suffix  . :
   Link-local IPv6 Address . . . . . : fe60::b525:6b90:8fb0:f513%58
   IPv4 Address. . . . . . . . . . . : 172.23.64.1
   Subnet Mask . . . . . . . . . . . : 255.255.240.0
   IPv4 Address. . . . . . . . . . . : 192.168.50.88
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . :</code></pre><p>以上两个命令可以写在一个 powershell 脚本文件内，脚本内设置管理员权限执行，由于需要管理员权限所以<strong>无法通过建立 shortcut 放到开机自启动文件夹来自动启动址</strong>。</p><p><code>wsl_ip.ps1</code> 脚本内容如下，会自动请求管理员权限：</p><pre><code>if (-NOT ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] &quot;Administrator&quot;))  
{  
  $arguments = &quot;&amp; '&quot; +$myinvocation.mycommand.definition + &quot;'&quot;
  Start-Process powershell -Verb runAs -ArgumentList $arguments
  Break
}

wsl -d Ubuntu -u root ip addr add 192.168.50.16/24 broadcast 192.168.50.255 dev eth0 label eth0:1
netsh interface ip add address &quot;vEthernet (WSL)&quot; 192.168.50.88 255.255.255.0
</code></pre><p>为了方便使用，可以将脚本路径加入系统 PATH 中，这样可以方便的在终端直接运行脚本，PATH 设置参考：<a href="https://blog.niekun.net/archives/413.html">https://blog.niekun.net/archives/413.html</a></p><p>完成后打开终端直接执行命令：<code>wsl_ip</code> 即可快速设置 IP。</p><p>参考链接：<a href="https://github.com/MicrosoftDocs/WSL/issues/418#issuecomment-648570865">https://github.com/MicrosoftDocs/WSL/issues/418#issuecomment-648570865</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1801.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1801.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[解决 proxifier 和 wsl 2 无法同时使用的问题]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1797.html" />
<id>https://blog.niekun.net/archives/1797.html</id>
<updated>2020-10-12T15:18:00+08:00</updated>
<published>2020-10-12T15:18:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[今天将 Windows 10 升级到了 build 2004 版，顺便将 wsl 升级到了 wsl 2，升级教程参考：https://blog.niekun.net/archives/1785....]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1797.html" xml:lang="zh-CN"><![CDATA[
<p>今天将 Windows 10 升级到了 build 2004 版，顺便将 wsl 升级到了 wsl 2，升级教程参考：<a href="https://blog.niekun.net/archives/1785.html">https://blog.niekun.net/archives/1785.html</a>。</p><p>运行 wsl 2 时，发现如下报错：</p><pre><code>PS C:\Users\Marco Nie&gt; wsl
The attempted operation is not supported for the type of object referenced.</code></pre><p>无法正常使用 wsl，查询后得知是由于我正在使用的 proxifier 和 wsl 有了冲突，proxifier 是我一直使用的用来代理程序的应用。在 wsl 的 github 项目讨论中看到有人问了 proxifier 开发者，得到了解决方法，需要使用提供的程序来让 wsl 在运行时不要加载 LSP DLLs。</p><ul><li>下载 <a href="https://blog.niekun.net/usr/uploads/2020/10/3243699170.zip">NoLsp.zip</a>，解压得到 NoLsp.exe</li><li>以管理员权限运行 terminal，执行 <code>path\to\NoLsp.exe c:\windows\system32\wsl.exe</code></li></ul><p>看到终端显示 <code>Succsess!</code>，表示操作完成，然后 wsl 系统就可以正常打开使用同时不影响 proxifier。</p><p>参考链接：<a href="https://github.com/microsoft/WSL/issues/4177">https://github.com/microsoft/WSL/issues/4177</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1797.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1797.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Windows 重建图标缓存]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1793.html" />
<id>https://blog.niekun.net/archives/1793.html</id>
<updated>2020-10-12T11:10:00+08:00</updated>
<published>2020-10-12T11:10:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[在使用 Windows 中有时候会发现某个程序或文件的图标显示不正常，一般是图标缓存的问题，重建一下即可。以 Windows 10 为例，图标缓存文件路径为：%LOCALAPPDATA%\Mic...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1793.html" xml:lang="zh-CN"><![CDATA[
<p>在使用 Windows 中有时候会发现某个程序或文件的图标显示不正常，一般是图标缓存的问题，重建一下即可。</p><p>以 Windows 10 为例，图标缓存文件路径为：<code>%LOCALAPPDATA%\Microsoft\Windows\Explorer</code></p><p>文件夹内的 <code>iconcache_*.db</code> 就是图标缓存文件，删除这些文件然后重启 explorer 即可。</p><p>下面介绍命令的方式处理，使用 power shell 终端：</p><pre><code># 停止 explorer 进程
taskkill /f /im explorer.exe

# 删除缓存图标文件，ps 中使用 $Env:&lt;variable-name&gt; 表达环境变量
del &quot;$env:LOCALAPPDATA\Microsoft\Windows\Explorer\iconcache*.db&quot;

# 重启 explorer
start explorer</code></pre><p>完成后查看图标是否已经正常显示。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1793.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1793.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Windows 常用终端命令]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1788.html" />
<id>https://blog.niekun.net/archives/1788.html</id>
<updated>2020-10-12T09:30:00+08:00</updated>
<published>2020-10-12T09:30:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[系统版本：winver系统详细信息：systeminfo当前用户名：whoami]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1788.html" xml:lang="zh-CN"><![CDATA[
<p>系统版本：</p><pre><code>winver
</code></pre><p>系统详细信息：</p><pre><code>systeminfo
</code></pre><p>当前用户名：</p><pre><code>whoami

</code></pre><!--more--><p>本地网络：</p><pre><code>ipconfig
</code></pre><p>刷新 DNS 缓存：</p><pre><code>ipconfig /flushdns
</code></pre><p>路由信息：</p><pre><code>pathping
tracert
</code></pre><p>cmd 命令换行符：</p><pre><code>echo abc
等同于：
echo ^
abc</code></pre><p>powershell 命令换行符：</p><pre><code>echo abc
等同于：
echo `
abc</code></pre><p>信息过滤：类似 Linux 的 grep</p><pre><code>findstr
systeminfo | findstr &quot;System Type&quot;
</code></pre><p>查看命令的帮助：</p><pre><code>pathping /?
findstr /?
systeminfo /?
</code></pre><p>显示所有端口情况：</p><pre><code>netstat -ano
</code></pre><p>显示某个端口的占用情况 返回的数据中最后的数字为 PID 号：</p><pre><code>netstat -aon|findstr &quot;7200&quot;
</code></pre><p>根据 PID 号结束对应进程：</p><pre><code>taskkill /f /pid  7200
</code></pre><p>结束某个进程：</p><pre><code>taskkill /f /im explorer.exe
</code></pre><p>删除某个文件：</p><pre><code>del &quot;IconCache.db&quot;
</code></pre><p>启动某个程序：</p><pre><code>start explorer
</code></pre>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1788.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1788.html" thr:count="0"/>
</entry>
<entry>
<title type="html"><![CDATA[Windows 10 Linux 子系统 WSL 升级到 WSL 2]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1785.html" />
<id>https://blog.niekun.net/archives/1785.html</id>
<updated>2020-10-12T09:24:00+08:00</updated>
<published>2020-10-12T09:24:00+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[Windows 10 上的 wsl 可以方便的运行 Linux 环境，最近从 wsl 升级到了 wsl 2，看了下介绍主要区别是：increase file system performance...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1785.html" xml:lang="zh-CN"><![CDATA[
<p>Windows 10 上的 wsl 可以方便的运行 Linux 环境，最近从 wsl 升级到了 wsl 2，看了下介绍主要区别是：</p><ul><li>increase file system performance</li><li>support full system call compatibility</li></ul><p>增加了系统性能，更加完善的 Linux 系统环境。</p><p>之前再 wsl 上无法使用的一些功能如 systemd 和网络 socket 提取的功能不知道是否可用了，下面就升级到 wsl 2 进行测试。</p><p>关于 wsl 的介绍和安装可以参考我的教程：<a href="https://blog.niekun.net/archives/1148.html">https://blog.niekun.net/archives/1148.html</a></p><!--more--><h3>环境要求</h3><p>Requirements：</p><ul><li>For x64 systems: Version 1903 or higher, with Build 18362 or higher.</li><li>For ARM64 systems: Version 2004 or higher, with Build 19041 or higher.</li><li>Builds lower than 18362 do not support WSL 2. Use the Windows Update Assistant to update your version of Windows.</li></ul><p>可以使用命令查看当前系统版本，快捷键 <code>win + R</code>，输入 <code>winver</code> 弹出系统信息：<br><img src="https://blog.niekun.net/usr/uploads/2020/10/2650368745.jpg" alt="1.jpg" title="1.jpg"></p><h3>命令行打开系统功能</h3><p>再我之前写的 wsl 安装教程里，介绍了从系统控制面板和命令行打开 <code>Windows Subsystem for Linux</code> 功能的方法，这里只介绍命令行方式。</p><p>首先以<strong>管理员权限</strong>打开 powershell。</p><p>如果之前没有安装 wsl 的话首先开启 <code>Windows Subsystem for Linux</code>：</p><pre><code>dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
</code></pre><p>然后开启 <code>Virtual Machine feature</code>：</p><pre><code>dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
</code></pre><p>完成以上两部后，重启系统。</p><p>重启完成后安装 Linux 内核更新包：<a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi">点击下载</a></p><p>再次重启系统。</p><p>设置 wsl 默认版本为 2：(管理员权限打开 powershell)</p><pre><code>wsl --set-default-version 2
</code></pre><p>设置默认版本后，以后安装的 Linux 子系统默认为 wsl 2 版本。</p><p>也可以将之前安装的 Linux 子系统升级到 wsl 2：</p><pre><code># 查看当前已安装的子系统
wsl -l -v

# 升级某个子系统到 wsl 2
wsl --set-version Ubuntu 2</code></pre><p>wsl 2 安装完成后就可以去 Windows 商店下载安装 Linux 发行版了：<a href="https://aka.ms/wslstore">https://aka.ms/wslstore</a></p><p>安装 Linux 发行版后的具体设置和之前 wsl 安装教程一样：<a href="https://blog.niekun.net/archives/1148.html">https://blog.niekun.net/archives/1148.html</a></p><h3>参考链接</h3><p><a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">https://docs.microsoft.com/en-us/windows/wsl/install-win10</a><br><a href="https://docs.microsoft.com/en-us/windows/wsl/compare-versions">https://docs.microsoft.com/en-us/windows/wsl/compare-versions</a></p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1785.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1785.html" thr:count="0"/>
</entry>
</feed>