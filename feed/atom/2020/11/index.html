<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"
xmlns:thr="http://purl.org/syndication/thread/1.0"
xml:lang="zh-CN"
xml:base="https://blog.niekun.net/2020/11/"
>
<title type="text">Marco Nie - 2020年11月</title>
<subtitle type="text">you are the company you keep...</subtitle>
<updated>2020-11-05T16:39:01+08:00</updated>
<generator uri="http://typecho.org/" version="1.2/18.10.23">Typecho</generator>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/2020/11/" />
<id>https://blog.niekun.net/feed/atom/2020/11/</id>
<link rel="self" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/2020/11/" />
<entry>
<title type="html"><![CDATA[VMware 虚拟机磁盘文件合并]]></title>
<link rel="alternate" type="text/html" href="https://blog.niekun.net/archives/1893.html" />
<id>https://blog.niekun.net/archives/1893.html</id>
<updated>2020-11-05T16:39:01+08:00</updated>
<published>2020-11-05T16:39:01+08:00</published>
<author>
    <name>admin</name>
    <uri>https://niekun.net</uri>
</author>
<summary type="html"><![CDATA[在创建 VMware workstation 虚拟机时，在磁盘选项上会提示选择创建单个虚拟磁盘文件或分割为多个文件。我喜欢使用单个文件，因为选择多个文件会在虚拟机目录下建立许多类似的 vmdk ...]]></summary>
<content type="html" xml:base="https://blog.niekun.net/archives/1893.html" xml:lang="zh-CN"><![CDATA[
<p>在创建 VMware workstation 虚拟机时，在磁盘选项上会提示选择创建单个虚拟磁盘文件或分割为多个文件。我喜欢使用单个文件，因为选择多个文件会在虚拟机目录下建立许多类似的 vmdk 文件，不太方便复制到其他地方。而且在导入 macOS 下的 VMware fusion 时会报错，所以推荐使用单个磁盘文件。</p><p>当现有的虚拟机已经是使用多个文件形式的话，可以使用 VMware workstation 附带的 vmware-vdiskmanager.exe 工具来进行合并。</p><!--more--><p>vmware-vdiskmanager.exe 是一个命令行工具，工具的位置在 VMware 安装路径下，如：<code>C:\Program Files (x86)\VMware\VMware Workstation\vmware-vdiskmanager.exe</code></p><p>在 PS 命令行下调用此工具查看帮助：</p><pre><code>PS C:\Users\Marco Nie&gt; &amp;&quot;vmware-vdiskmanager.exe&quot;
VMware Virtual Disk Manager - build 16894299.
Usage: vmware-vdiskmanager.exe OPTIONS &lt;disk-name&gt; | &lt;mount-point&gt;
Offline disk manipulation utility
  Operations, only one may be specified at a time:
     -c                   : create disk.  Additional creation options must
                            be specified.  Only local virtual disks can be
                            created.
     -d                   : defragment the specified virtual disk. Only
                            local virtual disks may be defragmented.
     -k                   : shrink the specified virtual disk. Only local
                            virtual disks may be shrunk.
     -n &lt;source-disk&gt;     : rename the specified virtual disk; need to
                            specify destination disk-name. Only local virtual
                            disks may be renamed.
     -p                   : prepare the mounted virtual disk specified by
                            the mount point for shrinking.
     -r &lt;source-disk&gt;     : convert the specified disk; need to specify
                            destination disk-type.  For local destination disks
                            the disk type must be specified.
     -x &lt;new-capacity&gt;    : expand the disk to the specified capacity. Only
                            local virtual disks may be expanded.
     -R                   : check a sparse virtual disk for consistency and attempt
                            to repair any errors.
     -e                   : check for disk chain consistency.
     -D                   : make disk deletable.  This should only be used on disks
                            that have been copied from another product.
     -U                   : delete/unlink a single disk link.

  Other Options:
     -q                   : do not log messages

  Additional options for create and convert:
     -a &lt;adapter&gt;         : (for use with -c only) adapter type
                            (ide, buslogic, lsilogic). Pass lsilogic for other adapter types.
     -s &lt;size&gt;            : capacity of the virtual disk
     -t &lt;disk-type&gt;       : disk type id

  Disk types:
      0                   : single growable virtual disk
      1                   : growable virtual disk split into multiple files
      2                   : preallocated virtual disk
      3                   : preallocated virtual disk split into multiple files
      4                   : preallocated ESX-type virtual disk
      5                   : compressed disk optimized for streaming
      6                   : thin provisioned virtual disk - ESX 3.x and above

     The capacity can be specified in sectors, KB, MB or GB.
     The acceptable ranges:
                           ide/scsi adapter : [1MB, 8192.0GB]
                           buslogic adapter : [1MB, 2040.0GB]
        ex 1: vmware-vdiskmanager.exe -c -s 850MB -a ide -t 0 myIdeDisk.vmdk
        ex 2: vmware-vdiskmanager.exe -d myDisk.vmdk
        ex 3: vmware-vdiskmanager.exe -r sourceDisk.vmdk -t 0 destinationDisk.vmdk
        ex 4: vmware-vdiskmanager.exe -x 36GB myDisk.vmdk
        ex 5: vmware-vdiskmanager.exe -n sourceName.vmdk destinationName.vmdk
        ex 6: vmware-vdiskmanager.exe -k myDisk.vmdk
        ex 7: vmware-vdiskmanager.exe -p &lt;mount-point&gt;
              (A virtual disk first needs to be mounted at &lt;mount-point&gt;)</code></pre><p><strong>VMware 生成的磁盘多个文件名称命名规则是如下：</strong></p><ul><li>根磁盘文件 - 如：Windows7.vmdk</li><li>分割磁盘文件 - 如：Windows7-s001.vmdk Windows7-s002.vmdk Windows7-s003.vmdk ...</li></ul><p><strong>使用命令合并多文件时只需要指定跟磁盘文件名称即可。</strong></p><p>根据帮助文档，使用 <code>-r</code> 指令指定多文件，<code>-t 0</code> 指令指定输出为单文件。示例如下：</p><pre><code>&amp;&quot;vmware-vdiskmanager.exe&quot; -r Windows7.vmdk -t 0 merge.vmdk

Creating disk 'merge.vmdk'
  Convert: 100% done.
Virtual disk conversion successful.</code></pre><p>命令执行后，在对应目录下会生成 merge.vmdk 虚拟磁盘文件，可以使用此文件建立新的虚拟机。</p>
]]></content>
<link rel="replies" type="text/html" href="https://blog.niekun.net/archives/1893.html#comments" thr:count="0" />
<link rel="replies" type="application/atom+xml" href="https://blog.niekun.net/feed/atom/archives/1893.html" thr:count="0"/>
</entry>
</feed>